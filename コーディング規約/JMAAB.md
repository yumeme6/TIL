# JMAAB (Japan MBD Automotive Advisory Board) について

## JMAAB とは

日本国内の自動車メーカーやサプライヤーが発起人となり設立された、MATLAB/Simulin
k のユーザー会

### メンバーの一例

トヨタ・日産・本田・マツダ・ヤマハ・SUBARU・日立・三菱 など

## MATLAB® PROGRAMMING GUIDELINES

要約を行っていく。
詳細は Guideline を確認すること。

### ファイル名

| ルール  | サブ | ルール                             | 備考                                 |
| ------- | ---- | ---------------------------------- | ------------------------------------ |
| mp_0001 | 𝐚   | ファイル名の文字数は規定値以内     | 3 文字以上、63 文字以内              |
| 〃      | 𝐛   | 末尾はアンダースコア"\_"以外       |                                      |
| 〃      | 𝐜   | アンダースコア"\_"は単独で使用     |                                      |
| 〃      | 𝐝   | ファイル名は同一にしない           | 例外：sl_customization.m、slblocks.m |
| 〃      | 𝐞   | ファイル名を MATLAB 予約語と以外に |                                      |

### フォルダー名

| ルール  | サブ | ルール                             | 備考        |
| ------- | ---- | ---------------------------------- | ----------- |
| mp_0002 | 𝐚   | フォルダー名の文字数は規定値以内   | 63 文字以内 |
| 〃      | 𝐛   | 先頭と末尾はアンダースコア"\_"以外 |             |
| 〃      | 𝐜   | アンダースコア"\_"は単独で使用     |             |
| 〃      | 𝐝   | ファイル名を予約後と同一にしない   |             |

### 識別子の命名

| ルール  | サブ | ルール                             | 備考                                 |
| ------- | ---- | ---------------------------------- | ------------------------------------ |
| mp_0003 | 𝐚   | プロジェクトで定めた命名規則に従う |                                      |
| 〃      | 𝐛   | 識別子は関数名と重複しない         |                                      |
| 〃      | 𝐜   | 同一の名前を持つ識別子を定義不可   | 例外：sl_customization.m、slblocks.m |
| 〃      | 𝐝   | 識別子名の文字数は規定値以内       | 3 文字以上、63 文字以内              |
| 〃      | 𝐞   | 先頭と末尾はアンダースコア"\_"以外 |                                      |
| 〃      | 𝐟   | アンダースコア"\_"は単独で使用     |                                      |
| 〃      | 𝐠   | ファイル名とメイン関数名は同一     |                                      |

### 制御構文(ステートメント)

IF~ELSE 内など

| ルール  | サブ | ルール                           | 備考                                                                                                                                              |
| ------- | ---- | -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------- |
| mp_0015 | ❌   | インデントを付けること           |                                                                                                                                                   |
| mp_0016 | ❌   | ネストの深さは既定値内           |                                                                                                                                                   |
| mp_0017 | ⭕   | 制御構文に関するコメントを記載   | a：制御構文全体のコメント<br> b：制御文に対するコメント<br>c：分岐後の処理についてコメント                                                        |
| mp_0018 | ⭕   | for と whiile の使い分けについて | ループ回数が実行時に規定できる場合は for 文<br>規定できない場合は while 文                                                                        |
| mp_0019 | ❌   | try/catch も mp_0017 適用        |                                                                                                                                                   |
| mp_0020 | ❌   | Switch/Case 関連                 | a：case 式は、定数値(動的に変化しない変数含む)を使用すること<br>b：case は２つ以上(1 つは IF を使用)<br>c：論理型は禁止(使用する場合は IF を使用) |
| mp_0021 | ❌   | ネストの深さは既定値内           |                                                                                                                                                   |
| mp_0022 | ❌   | ネストの深さは既定値内           |                                                                                                                                                   |
| mp_0023 | ❌   | ネストの深さは既定値内           |                                                                                                                                                   |

### 記述の統一

特有のルール
| ルール  | サブ | ルール                                               | 備考                                                 |
| ------- | ---- | ---------------------------------------------------- | ---------------------------------------------------- |
| mp_0004 | ❌   | MATLAB のデフォルト設定を使用                        |                                                      |
| mp_0005 | ❌   | インデント幅は PJ の既定値を使用                     | インデント幅 8                                       |
| mp_0006 | ❌   | 処理が複数行の場合、既定のインデント段数を使用       |                                                      |
| mp_0011 | ❌   | 演算子の前後及びコンマの後ろには半角スペースを入れる | 単項演算子とオペランドの間には半角スペースを入れない |
| mp_0012 | ❌   | コメントを記述する際は"%"を記述する                  | （%{ ～ %}）は使用しない                             |
| mp_0013 | ❌   | デバッグコードには、リマインダーコメントを付与する   | “TODO”、”FIXME”など                                  |

基本的なルール
| ルール  | サブ | ルール                                                 | 備考                                                       |
| ------- | ---- | ------------------------------------------------------ | ---------------------------------------------------------- |
| mp_0007 | ⭕   | 1 行に複数の実行文を記述しない                         | a：if foo > 0;bar = 10;end<br>b：最後はセミコロン(;)を記述 |
| mp_0008 | ⭕   | 不要なスペースを入れない                               | a：foo( bar)<br>b：foo(bar )<br>c：foo (bar)               |
| mp_0009 | ❌   | 構造体メンバーのコンマ演算子の前後にスペースを入れない | NG 例：str .data1                                          |
| mp_0010 | ❌   | 括弧で演算順序を明確化                                 |                                                            |
| mp_0014 | ❌   | 小数点の前のゼロは省略しない                           | .5 など                                                    |

### 変数

特段珍しいルールはない。当たり前のことが記載してある。

| ルール  | サブ | ルール                         | 備考                            |
| ------- | ---- | ------------------------------ | ------------------------------- |
| mp_0041 | ⭕   | 変数は初期化すること           |                                 |
| mp_0042 | ⭕   | 原則グローバル変数は使用しない | a：使用不可<br>b：必要最小限    |
| mp_0043 | ❌   | 未使用の変数は定義しない       | 使用しない戻り値は、"~"を使用。 |
| mp_0044 | ❌   | マジックナンバーは使用しない   | 0,1 は例外                      |
| mp_0045 | ❌   | 型変更(キャスト)は使用しない   |                                 |
| mp_0046 | ⭕   | 配列インデックスの記述方法     | 公式参照推奨                    |

### 関数

特段珍しいルールはないが、一部 MATRAB 特有仕様に関わってきているものがあるため注意。

| ルール  | サブ | ルール                                   | 備考                                                                                             |
| ------- | ---- | ---------------------------------------- | ------------------------------------------------------------------------------------------------ |
| mp_0024 | ⭕   | 無名関数の使用可否選択                   | a：可<br>b：否<br>無名関数の例『sqr = @(x) x.^2』                                                |
| mp_0025 | ⭕   | 関数の呼び出し方法                       | a：関数構文『pi()』<br>b：引数なし関数『pi or pi()』<br>c：呼び出しの階層制限<br>d：再帰使用不可 |
| mp_0026 | ❌   | プライベート関数の使用方法               | private フォルダーに配置                                                                         |
| mp_0027 | ❌   | 戻り値の","の記述                        | function [pi1, pi2] = (略)                                                                       |
| mp_0028 | ❌   | 入れ子関数の不使用                       |                                                                                                  |
| mp_0029 | ⭕   | 関数定義(引数なし)の"()"の記述方法       | a1：function pi = func1()<br>a2：function pi = func1                                             |
| mp_0030 | ❌   | 戻り値の型を同じにすること               | C 言語と違い、型宣言がないため                                                                   |
| mp_0031 | ❌   | 開発環境ツールは関数で機能を実現すること |                                                                                                  |
| mp_0032 | ❌   | ヘッダーを記載すること                   |                                                                                                  |
| mp_0040 | ⭕   | 戻り値は変数に代入して出力すること       | 公式参照推奨(特に a1)                                                                            |
| mp_0033 | ❌   | 入力変数は変更しないこと                 |                                                                                                  |
| mp_0034 | ❌   | 関数の長さは既定値以下                   | 目安 88 行以下                                                                                   |

### MATLAB 組み込み関数

| ルール  | サブ | ルール                                | 備考                                                                                                         |
| ------- | ---- | ------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| mp_0035 | ❌   | 型に応じた処理を実施                  | 戻り値の型が不定となる場合                                                                                   |
| mp_0036 | ❌   | exist を使用する場合、kind 引数を指定 |                                                                                                              |
| mp_0037 | ❌   | 文字列の比較には strcmp を使用します  | isequal や”==“は不使用                                                                                       |
| mp_0038 | ⭕   | ファイル操作関数                      | a：fopen、fclose を使用<br>b：二重に fopen を使用しない<br>c：'r'を指定した場合、fprintf,fwrite を使用しない |
| mp_0039 | ❌   | モデルコンパイルの記述方法            | ([], [], [], 'compile')後は、([], [], [], 'term')を使用すること                                              |

### その他

| ルール  | サブ | ルール                     | 備考                          |
| ------- | ---- | -------------------------- | ----------------------------- |
| mp_0047 | ❌   | 何らかの処理を記載すること |                               |
| mp_0048 | ❌   | 実行できない文禁止         |                               |
| mp_0049 | ❌   | ゼロ除算禁止               |                               |
| mp_0050 | ❌   | 文字列を直接算術禁止       | 例：double('a') - double('A') |

## 参考文献一覧

[JMAAB](https://jmaab.jp/)

Japan MBD Automotive Advisory Board (JMAAB) .  
[MATLAB® PROGRAMMING GUIDELINES Version 2.0（日本語版）](https://jmaab.jp/file/5971238ff213cf937653f0194ec937d8e0f1aa013c70ccc665896c6bc21edc44/373fd70e68f5e86889685a37a83eba24/attention) (2019 年 08 月 31 日)
